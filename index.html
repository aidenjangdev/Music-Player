<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Electron</title>

	<style>
		:root {
			--hover: rgba(255,255,255,0.1);
			--hover-close: #e81123;
		}

		html, body {
			width: 100%;
			height: 100%;
			margin: 0;
		}

		body {
			background: transparent;
			color: white;
			font-family: system-ui;
			overflow: hidden;
		}

		.app {
			display: flex;
			width: 100vw;
			height: 100vh;
		}

		.sidebar {
			width: 30vw;
			background-color: #c3c3c3aa;
			border-right: 1px solid #222;
			-webkit-app-region: no-drag;
			display: flex;
			flex-direction: column;
		}

		.sidebar-header {
			padding: 16px;
			border-bottom: 1px solid #222;
		}

		.sidebar-header h2 {
			margin: 0 0 12px 0;
			font-size: 18px;
		}

		.add-file-btn {
			width: 100%;
			padding: 10px;
			background-color: #555;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 14px;
		}

		.add-file-btn:hover {
			background-color: #666;
		}

		.playlist {
			flex: 1;
			overflow-y: auto;
			padding: 8px;
		}

		.playlist-item {
			padding: 12px;
			margin-bottom: 4px;
			background-color: rgba(255,255,255,0.1);
			border-radius: 5px;
			cursor: pointer;
			transition: background-color 0.2s;
		}

		.playlist-item:hover {
			background-color: rgba(255,255,255,0.2);
		}

		.playlist-item.active {
			background-color: rgba(255,255,255,0.3);
		}

		.playlist-item-name {
			font-size: 14px;
			margin-bottom: 4px;
		}

		.playlist-item-duration {
			font-size: 11px;
			opacity: 0.7;
		}

		.main {
			flex: 1;
			display: flex;
			flex-direction: column;
		}

		.titlebar {
			height: 32px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			-webkit-app-region: drag;
		}

		.window-controls {
			display: flex;
			-webkit-app-region: no-drag;
		}

		.btn {
			width: 46px;
			height: 32px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: default;
		}

		.btn:hover {
			background: var(--hover);
		}

		.btn.close:hover {
			background: var(--hover-close);
		}

		svg {
			width: 10px;
			height: 10px;
			fill: none;
			stroke: white;
			stroke-width: 1.5;
		}

		.content {
			flex: 1;
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
		}

		.now-playing {
			flex: 1;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 16px;
			text-align: center;
		}

		.now-playing h1 {
			margin: 0;
			font-size: 24px;
			font-weight: 500;
			cursor: text;
			padding: 8px;
			border-radius: 5px;
			transition: background-color 0.2s;
		}

		.now-playing h1:hover {
			background-color: rgba(255,255,255,0.1);
		}

		.now-playing input {
			margin: 0;
			font-size: 24px;
			font-weight: 500;
			background: transparent;
			border: none;
			color: white;
			text-align: center;
			width: 100%;
			outline: none;
			padding: 8px;
			border-radius: 5px;
			background-color: rgba(255,255,255,0.2);
		}

		.controls-wrapper {
			width: 100%;
		}

		img {
			width: 70px;
		}

		.controls {
			display: flex;
			gap: 16px;
			padding: 0 16px;
			box-sizing: border-box;
		}

		.controls button {
			border-radius: 5vw;
			background-color: #d7d7d77f;
			flex: 1;
			height: 30vh;
			border: none;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		/* ===== 공통 range 스타일 ===== */
		.range {
			width: 100%;
			-webkit-appearance: none;
			appearance: none;
			height: 4px;
			border-radius: 2px;
			background: linear-gradient(
				to right,
				#ffffff 0%,
				#ffffff var(--value, 0%),
				rgba(255,255,255,0.3) var(--value, 0%),
				rgba(255,255,255,0.3) 100%
			);
			outline: none;
			cursor: pointer;
		}

		.range::-webkit-slider-thumb {
			-webkit-appearance: none;
			width: 14px;
			height: 14px;
			border-radius: 50%;
			background: white;
			box-shadow: 0 0 0 4px rgba(255,255,255,0.15);
			transition: transform 0.15s ease, box-shadow 0.15s ease;
		}

		.range::-webkit-slider-thumb:hover {
			transform: scale(1.1);
		}

		.range::-webkit-slider-thumb:active {
			transform: scale(1.2);
		}

		/* ===== 진행바 ===== */
		.progress {
			padding: 0 16px 12px 16px;
		}

		.progress-bar-wrapper {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.progress input {
			flex: 1;
		}

		.time-display {
			font-size: 12px;
			white-space: nowrap;
		}

		/* ===== 볼륨 ===== */
		.volume {
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 16px;
			box-sizing: border-box;
		}

		.volume span {
			width: 48px;
			text-align: right;
			font-size: 14px;
		}

		#fileInput {
			display: none;
		}
	</style>
</head>

<body>
	<div class="app">
		<div class="sidebar">
			<div class="sidebar-header">
				<h2>축제노래잘좀틀자~~~</h2>
				<button class="add-file-btn" onclick="document.getElementById('fileInput').click()">
					+ 파일 추가
				</button>
				<input type="file" id="fileInput" accept="audio/*,video/*" multiple />
			</div>
			<div class="playlist" id="playlist"></div>
		</div>

		<div class="main">
			<div class="titlebar">
				<div></div>
				<div class="window-controls">
					<div class="btn" onclick="window.windowControls.minimize()">
						<svg viewBox="0 0 10 10"><line x1="1" y1="5" x2="9" y2="5"/></svg>
					</div>
					<div class="btn" onclick="window.windowControls.maximize()">
						<svg viewBox="0 0 10 10"><rect x="1.5" y="1.5" width="7" height="7"/></svg>
					</div>
					<div class="btn close" onclick="window.windowControls.close()">
						<svg viewBox="0 0 10 10">
							<line x1="2" y1="2" x2="8" y2="8"/>
							<line x1="8" y1="2" x2="2" y2="8"/>
						</svg>
					</div>
				</div>
			</div>

			<div class="content">
				<div class="now-playing">
					<h1 id="nowPlayingTitle">재생 중인 곡이 없기</h1>
				</div>

				<audio id="nowAudio"></audio>

				<div class="controls-wrapper">
					<!-- 커스텀 진행바 -->
					<div class="progress">
						<div class="progress-bar-wrapper">
							<span class="time-display" id="currentTime">0:00</span>
							<input
								id="progressBar"
								class="range"
								type="range"
								min="0"
								max="100"
								value="0"
							/>
							<span class="time-display" id="totalTime">0:00</span>
						</div>
					</div>

					<div class="controls">
						<button id="gotostart">
							<img src="assets/tostart.png">
						</button>
						<button id="playpauseButton">
							<img src="assets/play.png">
						</button>
					</div>

					<div class="volume">
						<input
							id="volumeSlider"
							class="range"
							type="range"
							min="0"
							max="100"
							value="100"
						/>
						<span id="volumeValue">100%</span>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		const audio = document.getElementById('nowAudio');
		const playBtn = document.getElementById('playpauseButton');
		const playImg = playBtn.querySelector('img');
		const gotoStartBtn = document.getElementById('gotostart');
		const fileInput = document.getElementById('fileInput');
		const playlist = document.getElementById('playlist');
		const nowPlayingTitle = document.getElementById('nowPlayingTitle');

		const progress = document.getElementById('progressBar');
		const volume = document.getElementById('volumeSlider');
		const volumeValue = document.getElementById('volumeValue');
		const currentTime = document.getElementById('currentTime');
		const totalTime = document.getElementById('totalTime');

		let isPlaying = false;
		let audioFiles = [];
		let currentIndex = -1;
		let isEditingTitle = false;

		// 확장자 제거 함수
		function removeExtension(filename) {
			return filename.replace(/\.[^/.]+$/, '');
		}

		// 시간 포맷 함수 (초 → 분:초)
		function formatTime(seconds) {
			if (isNaN(seconds)) return '0:00';
			const mins = Math.floor(seconds / 60);
			const secs = Math.floor(seconds % 60);
			return `${mins}:${secs.toString().padStart(2, '0')}`;
		}

		// 파일 추가
		fileInput.onchange = (e) => {
			const files = Array.from(e.target.files);
			files.forEach(file => {
				const url = URL.createObjectURL(file);
				audioFiles.push({
					name: removeExtension(file.name),
					originalName: file.name,
					url: url,
					duration: 0
				});
			});
			renderPlaylist();
			fileInput.value = '';
		};

		// 재생목록 렌더링
		function renderPlaylist() {
			playlist.innerHTML = '';
			audioFiles.forEach((file, index) => {
				const item = document.createElement('div');
				item.className = 'playlist-item';
				if (index === currentIndex) {
					item.classList.add('active');
				}
				item.innerHTML = `
					<div class="playlist-item-name">${file.name}</div>
					<div class="playlist-item-duration">${formatTime(file.duration)}</div>
				`;
				item.onclick = () => playTrack(index);
				playlist.appendChild(item);
			});
		}

		// 트랙 선택 (재생은 안 함)
		function playTrack(index) {
			// 먼저 진행바와 시간 표시 초기화
			progress.value = 0;
			progress.style.setProperty("--value", "0%");
			currentTime.textContent = "0:00";
			totalTime.textContent = "0:00";
			
			// 오디오 정지 및 초기화
			audio.pause();
			isPlaying = false;
			playImg.src = "assets/play.png";
			
			currentIndex = index;
			const file = audioFiles[index];
			
			// 새 오디오 로드
			audio.src = file.url;
			audio.load(); // 강제 로드
			audio.currentTime = 0;
			
			nowPlayingTitle.textContent = file.name;
			renderPlaylist();
		}

		// 오디오 로드 시작 시 진행바 초기화
		audio.onloadstart = () => {
			progress.value = 0;
			progress.style.setProperty("--value", "0%");
			currentTime.textContent = "0:00";
		};

		// 오디오 메타데이터 로드 시
		audio.onloadedmetadata = () => {
			totalTime.textContent = formatTime(audio.duration);
			if (currentIndex >= 0) {
				audioFiles[currentIndex].duration = audio.duration;
				renderPlaylist();
			}
			// 메타데이터 로드 후에도 진행바 확인
			progress.value = 0;
			progress.style.setProperty("--value", "0%");
			currentTime.textContent = "0:00";
		};

		playBtn.onclick = () => {
			if (currentIndex < 0) return;
			if (isPlaying) {
				audio.pause();
				playImg.src = "assets/play.png";
			} else {
				audio.play();
				playImg.src = "assets/pause.png";
			}
			isPlaying = !isPlaying;
		};

		// 처음으로 가기 버튼
		gotoStartBtn.onclick = () => {
			audio.pause();
			audio.currentTime = 0;
			playImg.src = "assets/play.png";
			isPlaying = false;
		};

		// 진행바 → 재생 위치
		progress.oninput = () => {
			audio.currentTime = (progress.value / 100) * audio.duration;
		};

		// 재생 위치 → 진행바
		audio.ontimeupdate = () => {
			const percent = (audio.currentTime / audio.duration) * 100;
			progress.value = percent;
			progress.style.setProperty("--value", percent + "%");
			currentTime.textContent = formatTime(audio.currentTime);
		};

		// 볼륨
		volume.oninput = () => {
			const v = volume.value;
			audio.volume = v / 100;
			volumeValue.textContent = v + "%";
			volume.style.setProperty("--value", v + "%");
		};

		// 초기 볼륨 설정
		volume.style.setProperty("--value", "100%");

		// 제목 클릭으로 편집
		nowPlayingTitle.onclick = () => {
			if (currentIndex < 0 || isEditingTitle) return;
			isEditingTitle = true;
			const currentName = audioFiles[currentIndex].name;
			nowPlayingTitle.innerHTML = `<input type="text" id="titleInput" value="${currentName}" />`;
			const input = document.getElementById('titleInput');
			input.focus();
			input.select();

			// 엔터키로 저장
			input.onkeydown = (e) => {
				if (e.key === 'Enter') {
					saveTitle();
				} else if (e.key === 'Escape') {
					cancelEdit();
				}
			};

			// 포커스 잃으면 저장
			input.onblur = () => {
				setTimeout(saveTitle, 100);
			};
		};

		function saveTitle() {
			if (!isEditingTitle) return;
			const input = document.getElementById('titleInput');
			if (input) {
				const newName = input.value.trim();
				if (newName) {
					audioFiles[currentIndex].name = newName;
				}
				nowPlayingTitle.textContent = audioFiles[currentIndex].name;
				renderPlaylist();
			}
			isEditingTitle = false;
		}

		function cancelEdit() {
			if (!isEditingTitle) return;
			nowPlayingTitle.textContent = audioFiles[currentIndex].name;
			isEditingTitle = false;
		}
	</script>
</body>
</html>